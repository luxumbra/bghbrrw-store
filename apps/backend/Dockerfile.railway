# Railway-specific Dockerfile for backend only
FROM node:20-alpine

# Install pnpm and medusa CLI
RUN npm install -g pnpm@latest @medusajs/cli@2.8.0

WORKDIR /app

# Copy backend package.json only
COPY package.json ./

# Install backend dependencies
RUN pnpm install

# Copy backend source code
COPY . .

# Build using the working global CLI (2.8.0 - stable version)
RUN medusa build

# Expose port
EXPOSE 9000

# Start using the working global CLI
CMD ["medusa", "start"]