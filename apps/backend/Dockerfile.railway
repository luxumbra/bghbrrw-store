# Production stage
FROM node:20-alpine

WORKDIR /app

COPY package.json medusa-config.ts tsconfig.json ./

# Install production dependencies only
RUN npm install -g pnpm
RUN pnpm install --prod --frozen-lockfile=false

# Create non-root user
RUN addgroup -g 1001 -S nodejs
RUN adduser -S medusa -u 1001
USER medusa

EXPOSE 9000
CMD ["node", ".medusa/server/index.js"]